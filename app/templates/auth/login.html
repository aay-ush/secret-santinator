{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>Login</h1>

  <form method="post" id="loginForm">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <label>Name</label>
    <input class="input" id="name" name="name" required>

    <input type="hidden" name="client_hash" id="client_hash">

    <button class="btn btn-primary" type="submit">Login</button>
  </form>

  <hr>

  <form method="post" action="{{ url_for('auth.request_reset') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <label>Forgot passphrase?</label>
    <input class="input" name="name" placeholder="Your name" required>

    <button class="btn">Request reset</button>
  </form>
</div>

<script>
document.getElementById("loginForm").onsubmit = async (e) => {
  e.preventDefault();
  const name = document.getElementById("name").value.trim();
  const pass = localStorage.getItem(keyForName(name));
  if (!pass) {
    alert("No saved passphrase on this device.");
    return;
  }
  document.getElementById("client_hash").value = await sha256Hex(pass);
  e.target.submit();
};
</script>
{% endblock %}

