{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>Register</h1>

  <form method="post" id="registerForm">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <label>Name</label>
    <input class="input" name="name" id="name" required>

    <label>Email (optional)</label>
    <input class="input" name="email" type="email">

    <label>Your generated passphrase</label>
    <input class="input" id="passphrase" readonly>

    <input type="hidden" name="client_hash" id="client_hash">

    <button class="btn btn-primary" type="submit">Register</button>
  </form>
</div>

<script>
(async () => {
  const pass = generatePassphrase(8);
  document.getElementById("passphrase").value = pass;

  document.getElementById("registerForm").onsubmit = async (e) => {
    e.preventDefault();
    const name = document.getElementById("name").value.trim();
    localStorage.setItem(keyForName(name), pass);
    document.getElementById("client_hash").value = await sha256Hex(pass);
    e.target.submit();
  };
})();
</script>
{% endblock %}

