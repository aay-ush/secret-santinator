{% extends "base.html" %}
{% block content %}
<h1>Dashboard</h1>

{% if assignment_locked %}
  <p>
    <strong>Assignments are locked!</strong>
    {% if assignment_run_at %}(run at {{ assignment_run_at }}){% endif %}
  </p>
{% else %}
  <p>
    ğŸŸ¡ <strong>Assignments are not locked</strong>
  </p>
{% endif %}

<p><strong>Total participants:</strong> {{ num_participants }}</p>

<hr>

<p>
  <a href="{{ url_for('santa.my_assignment') }}">ğŸ My Assignment</a>
  &nbsp; | &nbsp;
  <a href="{{ url_for('santa.preferences') }}">âš™ï¸ My Preferences</a>
</p>

{% if is_admin %}
  <hr>
  <h2>Admin</h2>

  <p>
    <a href="{{ url_for('santa.admin_participants') }}">ğŸ‘¥ Manage participants</a>
  </p>

  <p>
    <a href="{{ url_for('santa.admin_run_assignments') }}">âœ… Run & lock assignments</a>
  </p>

  <form method="post"
        action="{{ url_for('santa.admin_unset_assignments') }}"
        onsubmit="return confirm('Unset all assignments and unlock? Users can update preferences and you will need to re-run assignments.');">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit">ğŸ§¹ Unset & unlock assignments</button>
  </form>

  <p style="margin-top:12px;">
    <a href="{{ url_for('santa.admin_run_assignments') }}"
       onclick="return confirm('Re-run and lock assignments now? Make sure participants and preferences are correct.');">
      ğŸ” Re-run assignments now
    </a>
  </p>

  <p style="margin-top:12px;">
    <a href="{{ url_for('santa.admin_resets') }}">ğŸ”‘ Reset requests ({{ reset_count }})</a>
  </p>
{% endif %}

{% endblock %}

