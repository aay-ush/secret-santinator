{% extends "base.html" %}
{% block content %}
<h1>Reset passphrase for {{ participant.name }}</h1>

<p>
  Use this only after personal confirmation. The participant should be present and should keep the new passphrase safe.
</p>

<form id="reset-form" method="post">
  <p><strong>New passphrase (generated on this device):</strong></p>
  <div id="reset-passphrase" style="font-weight:bold; font-size:1.1em;"></div>
  <button type="button" id="reset-new">Give me another</button>

  <input type="hidden" name="client_hash" id="reset-client-hash">

  <p style="margin-top:1em;">
    This device will remember it under the participantâ€™s name.
  </p>

  <button type="submit">Use this passphrase</button>
</form>

<script>
let currentPhrase = "";

function refreshPhrase() {
  currentPhrase = generatePassphrase(6);
  document.getElementById("reset-passphrase").textContent = currentPhrase;
}

document.getElementById("reset-new").addEventListener("click", refreshPhrase);
refreshPhrase();

document.getElementById("reset-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  // Save locally on this device
  localStorage.setItem(keyForName("{{ participant.name }}"), currentPhrase);

  // Send only SHA-256(passphrase)
  document.getElementById("reset-client-hash").value = await sha256Hex(currentPhrase);

  e.target.submit();
});
</script>
{% endblock %}

