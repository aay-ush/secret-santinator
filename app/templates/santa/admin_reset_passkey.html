{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>Set Temporary Passphrase</h1>
  <p class="muted">
    Participant: <strong>{{ participant.name }}</strong><br>
    They will be forced to change this passphrase on first login.
  </p>

  <form id="temp-form" method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="form-row">
      <label for="temp-passphrase">Temporary passphrase</label>
      <input class="input" type="password" id="temp-passphrase" required>
    </div>

    <input type="hidden" name="client_hash" id="client-hash">

    <button class="btn btn-primary" type="submit">Set temporary passphrase</button>
    <a class="btn" href="{{ url_for('santa.admin_resets') }}" style="margin-left: 8px;">Back</a>
  </form>
</div>

<script>
(function(){
  const form = document.getElementById("temp-form");
  const pass = document.getElementById("temp-passphrase");
  const out = document.getElementById("client-hash");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const phrase = (pass.value || "").trim();
    if (!phrase) { alert("Temporary passphrase is required."); return; }

    // Send only SHA-256(passphrase) to server
    out.value = await sha256Hex(phrase);
    e.target.submit();
  });
})();
</script>
{% endblock %}

